<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>üè• Tableau de bord Admin</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #2c3e50; }
        .welcome { background: #e8f4fc; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .logout-btn { background: #e74c3c; color: white; padding: 8px 15px; text-decoration: none; border-radius: 5px; float: right; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #3498db; color: white; }
        .status-upload { background: #fff3cd; }
        .status-attribue { background: #d1ecf1; }
        .status-termine { background: #d4edda; }
        .create-user-form { background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 30px 0; border: 1px solid #dee2e6; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; }
        .submit-btn { background: #27ae60; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        .delete-btn { background: #e74c3c; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; }
        .users-table { margin-top: 40px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>üè• Tableau de bord Admin</h2>
        <div class="welcome">
            Bonjour, {{ session['full_name'] }}<br>
            {{ session['user_email'] }}
            <a href="/logout" class="logout-btn">üö™ D√©connexion</a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div style="margin: 20px 0; padding: 15px; background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 5px;">
                    {% for category, message in messages %}
                        <p>{{ message }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Formulaire de cr√©ation de compte -->
        <div class="create-user-form">
            <h3>‚ûï Cr√©er un nouveau compte</h3>
            <form method="POST">
                <input type="hidden" name="action" value="create_user">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Mot de passe</label>
                    <input type="password" name="password" required>
                </div>
                <div class="form-group">
                    <label>Nom complet</label>
                    <input type="text" name="full_name" required>
                </div>
                <div class="form-group">
                    <label>R√¥le</label>
                    <select name="role" required>
                        <option value="technicien">Technicien</option>
                        <option value="medecin">M√©decin</option>
                        <option value="agent_tireur">Agent Tireur</option>
                    </select>
                </div>
                <button type="submit" class="submit-btn">‚úÖ Cr√©er le compte</button>
            </form>
        </div>

        <!-- Liste des utilisateurs -->
        <div class="users-table">
            <h3>üë• Liste des utilisateurs</h3>
            <table>
                <thead>
                    <tr>
                        <th>Nom complet</th>
                        <th>Email</th>
                        <th>R√¥le</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.full_name }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.role }}</td>
                        <td>
                            {% if user.role != 'admin' %}
                            <form method="POST" style="display: inline;">
                                <input type="hidden" name="action" value="delete_user">
                                <input type="hidden" name="user_id" value="{{ user.id }}">
                                <button type="submit" class="delete-btn" onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer ce compte ?')">üóëÔ∏è Supprimer</button>
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <h3 style="margin-top: 40px;">üìã Tous les examens</h3>
        <table>
            <thead>
                <tr>
                    <th>Patient</th>
                    <th>Technicien</th>
                    <th>M√©decin</th>
                    <th>Agent Tireur</th>
                    <th>Date Upload</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for exam in exams %}
                <tr class="status-{{ exam.status|lower }}">
                    <td>{{ exam.patient_nom }} {{ exam.patient_prenom }} (ID: {{ exam.patient_id_patient }})</td>
                    <td>{{ exam.technicien_full_name or 'Non attribu√©' }}</td>
                    <td>{{ exam.medecin_full_name or 'Non attribu√©' }}</td>
                    <td>{{ exam.agent_tireur_full_name or 'Non attribu√©' }}</td>
                    <td>{{ exam.uploaded_at }}</td>
                    <td>{{ exam.status }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>